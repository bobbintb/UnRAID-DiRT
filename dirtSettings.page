Menu="Utilities"
Title="Deduplication in Real-Time"
Icon="fa-search-minus"
---
<?
$plugin  = 'bobbintb.system.dirt';
$cfg     = parse_plugin_cfg($plugin);
$width   = [400,300];
$blacklist = ['system'];
$cfg['datetime_format']		= $cfg['datetime_format='] ?? "f";
$cfg['share'] = $cfg['share'] ?? implode(',', array_diff(array_column($shares, 'name'), $blacklist));
?>

<script>
function scan() {
  fetch(`<?php echo "http://" . $_SERVER["SERVER_ADDR"] . ":3000"; ?>/scan`)
    .then(response => response.json())
    .then(data => {
      console.log(data);
    })
    .catch(error => {
      console.error('Error:', error);
    });
}

function prepareShare(form) {
  var share = '';
  for (var i=0,item; item=form.share.options[i]; i++) {
    if (item.selected) {
      if (share.length) share += ',';
      share += item.value;
      item.selected = false;
    }
  }
  item = form.share.options[0];
  item.value = share;
  item.selected = true;
  $('input.thin').prop('disabled',false);
}

$(function() {
  $('#s1').dropdownchecklist({emptyText:'_(None)_', width:<?=$width[0]?>, explicitClose:'..._(close)_'});
});
</script>
<form markdown="1" name="dirt_settings" method="POST" action="/update.php" target="progressFrame" onsubmit="prepareShare(this)">
<input type="hidden" name="#file" value="<?=$plugin?>/<?=$plugin?>.cfg">

_(Included share(s))_:
: <select id="s1" name="share" multiple style="display:none">
  <?foreach ($shares as $share):?>
  <?=mk_option_check($cfg['share'], $share['name'], $share['name'])?>
  <?endforeach;?>
  </select>

_(Datetime format)_:
: <input name="datetime_format" type="text" value="<?=$cfg['datetime_format']?>">

:dirt_plug:
> The datetime format for file metadata. See here for available options: [Luxon Date Tokens](https://moment.github.io/luxon/#/parsing?id=table-of-tokens)
:end

<input type="submit" name="#default" value="_(Default)_" onclick="$('input[class^=disk]').prop('checked',false)">
: <input type="submit" name="#apply" value="_(Apply)_"><input type="button" value="_(Scan)_" onclick="scan()"><input type="button" value="_(Done)_" onclick="done()">
</form>
