Menu="DiskUtilities"
Title="Deduplication in Real-Time"
Icon="fa-search-minus"
---
<?PHP

?>
<style>
    #main_container {
        --main_container_height: 65vh;
        //border:1px solid black;
        height: var(--main_container_height);
        display: flex;
        flex-direction: row;
        margin-top: -30px;
    }

    .disabled {
        background-color: #ccc !important;
        color: #888 !important;
        cursor: default !important;
        pointer-events: none !important;    }

    .strike-through {
        text-decoration: line-through red;
    }

    #left {
        //border:1px solid red;
        resize: horizontal;
        width: 70%;
        min-width: 20%;
        max-width: 80%;
        overflow: auto;
        //margin-left: 10px;
        margin-right: 5px;
    }


    #left.tabulator {
        font-size: 12px;
    }

    #right {
        //border:1px solid blue;
        flex: 1;
        margin-left: 5px;
        //margin-right: 10px;
    }

    #bottom_container {
        --bottom_container_height: 10vh;
    //border:1px solid black;
        height: var(--bottom_container_height);
        display: flex;
        flex-direction: row;
    }
    #bleft {
        border:1px solid red;
        resize: horizontal;
        overflow: auto;
        width: 70%;
    }

    #bright {
    border:1px solid blue;
        flex: 1;
        margin-left: 5px;
    //margin-right: 10px;
    }
</style>

<script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.2.1/dist/js/tabulator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon/build/global/luxon.min.js"></script>

<script>

    let matchingObjects;

    async function hash() {
        try {
            console.error("Starting fetch...");
            const response = await Promise.race([
                fetch(`<?php echo "http://" . $_SERVER["SERVER_ADDR"] . ":3000"; ?>/hash`),
                new Promise((_, reject) =>
                    setTimeout(() => reject(new Error('Request timed out')), 5000) // 5 seconds timeout
                )
            ]);

            console.error("Fetch completed.");

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            console.error("Fetched data:", data);
            return data;
        } catch (error) {
            console.error('Error fetching data:', error);
            return null;
        }
    }
    async function fetchData() {
        matchingObjects = await hash();
        if (matchingObjects) {
            console.error("redisData:", matchingObjects); // This should log the fetched data
        } else {
            console.error("No data returned or an error occurred.");
        }
    }

    fetchData();

</script>
<div id="main_container">
        <link href="https://unpkg.com/tabulator-tables@6.2.1/dist/css/tabulator.min.css" rel="stylesheet">
        <div id="left"><?php include './plugins/bobbintb.system.dedupe/php/left.php'; ?></div>
        <div id="right"><?php include './plugins/bobbintb.system.dedupe/php/right.php'; ?></div>

</div>
<div id="bottom_container">
<div id="bleft"></div>
<div id="bright"></div>
</div>