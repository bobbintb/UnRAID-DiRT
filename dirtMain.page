Menu="DiskUtilities"
Title="Deduplication in Real-Time"
Icon="fa-search-minus"
---
<?PHP

?>
<head>
    <link type="text/css" rel="stylesheet" href="<?autov('/plugins/bobbintb.system.dirt/css/dirt.css');?>">
    <link href="https://unpkg.com/tabulator-tables@6.3/dist/css/tabulator.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@6.3/dist/js/tabulator.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm@4.8.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-fit@0.5.0/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@xterm/addon-attach@0.5.0/lib/xterm-addon-attach.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@4.8.0/css/xterm.css" />

</head>
<body>
<script type="module">
    // import {dirt} from "../nodejs/dirt.js";
    const socket = new WebSocket(`<?php echo "ws://" . $_SERVER["SERVER_ADDR"] . ":3000"; ?>`);
    async function connectWebSocket() {
        await new Promise(resolve => socket.addEventListener("open", resolve, { once: true }));
    }

    await connectWebSocket();
    socket.onopen = () => {
        console.log("WebSocket connected");
    };

    // Listen for messages from the server
    socket.addEventListener('message', (event) => {
        const consoleOutput = document.getElementById('console-output');
        consoleOutput.innerHTML = event.data;  // Append new messages to the console output
    });

    $(function() {
        let current_progress = 0;
        const interval = setInterval(function () {
            current_progress += 10;
            $("#dynamic")
                .css("width", current_progress + "%")
                .attr("aria-valuenow", current_progress)
                .text(current_progress + "% Complete");
            if (current_progress >= 100)
                clearInterval(interval);
        }, 1000);
    });
</script>
<div class="progress">
    <div id="dynamic" class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
        <span id="current-progress"></span>
    </div>
</div>
<div id="console-output" style="white-space: pre-wrap;"></div>
<div id="buttonBox" style="margin-top: -5px; text-align: right;">
    <input type="button" id="processButton" value="_(Process)_">
    <input type="button" id="clearButton" value="_(Clear)_">
</div>
<div id="dirt"><?php include './plugins/bobbintb.system.dirt/php/dirt.php'; ?></div>
</body>